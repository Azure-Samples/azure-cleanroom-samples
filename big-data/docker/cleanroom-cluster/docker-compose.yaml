services:
  # We are forced to have a docker compose even for a single service since az cli commands expect
  # to find the CCF provider container as part of a compose project and look for a 'client-1'
  # container within.
  client:
    image: ${AZCLI_CLEANROOM_CLUSTER_PROVIDER_CLIENT_IMAGE}
    ports:
      - "0:8080"
    environment:
      - IDENTITY_ENDPOINT=${CREDENTIAL_PROXY_ENDPOINT}
      - IMDS_ENDPOINT="dummy_required_value"
      - CR_CLUSTER_PROVIDER_PROXY_IMAGE=${AZCLI_CLEANROOM_CLUSTER_PROVIDER_PROXY_IMAGE}
      - CR_CLUSTER_PROVIDER_ATTESTATION_IMAGE=${AZCLI_CLEANROOM_CLUSTER_PROVIDER_ATTESTATION_IMAGE}
      - CR_CLUSTER_PROVIDER_GOVERNANCE_IMAGE=${AZCLI_CLEANROOM_CLUSTER_PROVIDER_GOVERNANCE_IMAGE}
      - CR_CLUSTER_PROVIDER_SKR_IMAGE=${AZCLI_CLEANROOM_CLUSTER_PROVIDER_SKR_IMAGE}
      - CR_CLUSTER_PROVIDER_CONTAINER_REGISTRY_URL=${AZCLI_CLEANROOM_CLUSTER_PROVIDER_CONTAINER_REGISTRY_URL}
      - CR_CLUSTER_PROVIDER_SIDECARS_POLICY_DOCUMENT_REGISTRY_URL=${AZCLI_CLEANROOM_SIDECARS_POLICY_DOCUMENT_REGISTRY_URL}
      - CR_CLUSTER_PROVIDER_SPARK_ANALYTICS_AGENT_IMAGE=${AZCLI_CLEANROOM_CLUSTER_PROVIDER_SPARK_ANALYTICS_AGENT_IMAGE}
      - CR_CLUSTER_PROVIDER_SPARK_ANALYTICS_AGENT_SECURITY_POLICY_DOCUMENT_URL=${AZCLI_CLEANROOM_CLUSTER_PROVIDER_SPARK_ANALYTICS_AGENT_SECURITY_POLICY_DOCUMENT_URL}
      - CR_CLUSTER_PROVIDER_SPARK_ANALYTICS_AGENT_CHART_URL=${AZCLI_CLEANROOM_CLUSTER_PROVIDER_SPARK_ANALYTICS_AGENT_CHART_URL}
      - CR_CLUSTER_PROVIDER_SPARK_FRONTEND_IMAGE=${AZCLI_CLEANROOM_CLUSTER_PROVIDER_SPARK_FRONTEND_IMAGE}
      - CR_CLUSTER_PROVIDER_SPARK_FRONTEND_SECURITY_POLICY_DOCUMENT_URL=${AZCLI_CLEANROOM_CLUSTER_PROVIDER_SPARK_FRONTEND_SECURITY_POLICY_DOCUMENT_URL}
      - CR_CLUSTER_PROVIDER_SPARK_FRONTEND_CHART_URL=${AZCLI_CLEANROOM_CLUSTER_PROVIDER_SPARK_FRONTEND_CHART_URL}
      - CR_CLUSTER_PROVIDER_CLEANROOM_SIDECARS_VERSIONS_DOCUMENT_URL=${AZCLI_CLEANROOM_SIDECARS_VERSIONS_DOCUMENT_URL}
      - CR_CLUSTER_PROVIDER_CLEANROOM_ANALYTICS_IMAGE_URL=${AZCLI_CLEANROOM_ANALYTICS_APP_IMAGE_URL}
      - CR_CLUSTER_PROVIDER_CLEANROOM_ANALYTICS_IMAGE_POLICY_DOCUMENT_URL=${AZCLI_CLEANROOM_ANALYTICS_APP_IMAGE_POLICY_DOCUMENT_URL}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    extra_hosts:
      - host.docker.internal:host-gateway
